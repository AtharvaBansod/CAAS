{
  "task_group": "dashboard-pages",
  "description": "Core console pages — Dashboard, API Keys, Security, Analytics, Audit Logs, Settings, Onboarding Wizard",
  "priority": "high",
  "estimated_hours": 48,
  "phase": "6.2",
  "feature_area": "admin-portal",
  "tasks": [
    {
      "id": "PORTAL-201",
      "task_name": "Dashboard Overview Page",
      "feature_details": "Create the main dashboard at /(dashboard)/dashboard/page.tsx. Layout: Top row of 4 stat cards (Active Users, Messages Today, API Calls, Active Connections) from GET /v1/tenant/usage. Below: two-column layout — Left: Activity Feed (recent audit events from compliance service), Right: Usage Chart (Recharts area chart showing message volume over last 7 days). Bottom: Quick Actions panel (Create API Key, Manage Whitelist, View Docs). All data fetched via TanStack Query hooks. Skeleton loading states for all cards.",
      "feature_dependency": [
        "PORTAL-109"
      ],
      "backend_apis_used": [
        "GET /v1/tenant/usage (Gateway — WORKING ✅)",
        "GET /v1/admin/dashboard (Gateway — WORKING ✅)",
        "GET /api/v1/audit/query (Compliance — WORKING ✅)"
      ],
      "backend_status": "All APIs WORKING ✅",
      "testing_instructions": {
        "unit_tests": [
          "Stat cards render with loading skeleton",
          "Stat cards display data correctly",
          "Activity feed renders audit events",
          "Usage chart renders with mock data"
        ],
        "integration_tests": [
          "Dashboard loads with real API data",
          "Quick actions navigate correctly",
          "Responsive layout at mobile breakpoint"
        ],
        "e2e_tests": [
          "Login → Dashboard displays correct tenant data"
        ]
      },
      "acceptance_criteria": [
        "4 stat cards with real-time data",
        "Activity feed shows recent audit events",
        "Usage chart renders with Recharts",
        "Quick actions panel with working links",
        "Skeleton loading states during fetch",
        "Responsive design"
      ],
      "files_to_create": [
        "apps/admin-portal/src/app/(dashboard)/dashboard/page.tsx",
        "apps/admin-portal/src/components/dashboard/StatCard.tsx",
        "apps/admin-portal/src/components/dashboard/ActivityFeed.tsx",
        "apps/admin-portal/src/components/dashboard/UsageChart.tsx",
        "apps/admin-portal/src/components/dashboard/QuickActions.tsx"
      ],
      "files_to_modify": [],
      "docker_requirements": {
        "services": [],
        "environment_variables": [],
        "volumes": [],
        "networks": []
      },
      "api_endpoints": [],
      "database_changes": {
        "collections": [],
        "indexes": [],
        "migrations": []
      },
      "status": "not_started",
      "estimated_hours": 8,
      "tags": [
        "portal",
        "dashboard",
        "charts",
        "analytics"
      ]
    },
    {
      "id": "PORTAL-202",
      "task_name": "API Keys Management Page",
      "feature_details": "Create API Keys page at /(dashboard)/api-keys/page.tsx. Features: DataTable listing all API keys (columns: Name, Key (masked with copy button), Scopes, Created, Last Used, Status). Create Key dialog (name, scopes checkboxes, optional expiry). Key detail view showing usage stats. Rotation workflow: Rotate button → confirms → calls rotate → shows secondary key → Promote button → calls promote. Delete key with confirmation modal. All CRUD via TanStack Query mutations with optimistic updates.",
      "feature_dependency": [
        "PORTAL-109"
      ],
      "backend_apis_used": [
        "GET /v1/auth/api-keys (Gateway — WORKING ✅)",
        "POST /v1/auth/api-keys (Gateway — WORKING ✅)",
        "DELETE /v1/auth/api-keys/:id (Gateway — WORKING ✅)",
        "POST /api/v1/auth/client/api-keys/rotate (Auth Service — WORKING ✅)",
        "POST /api/v1/auth/client/api-keys/promote (Auth Service — WORKING ✅)",
        "POST /api/v1/auth/client/api-keys/revoke (Auth Service — WORKING ✅)"
      ],
      "backend_status": "All APIs WORKING ✅ — Full lifecycle tested in E2E Phase 3",
      "testing_instructions": {
        "unit_tests": [
          "DataTable renders key list",
          "Key is masked with copy button",
          "Create dialog validates fields",
          "Delete confirmation modal works"
        ],
        "integration_tests": [
          "Create key → appears in table",
          "Rotate → shows secondary → Promote → primary updated",
          "Delete → key removed from table",
          "Optimistic updates work correctly"
        ],
        "e2e_tests": [
          "Full key lifecycle: create → rotate → promote → delete"
        ]
      },
      "acceptance_criteria": [
        "DataTable with sorting, pagination",
        "Create, Rotate, Promote, Revoke, Delete all functional",
        "Key values masked by default, copy to clipboard",
        "Optimistic UI updates",
        "Error handling with rollback",
        "Empty state when no keys exist"
      ],
      "files_to_create": [
        "apps/admin-portal/src/app/(dashboard)/api-keys/page.tsx",
        "apps/admin-portal/src/components/api-keys/KeyTable.tsx",
        "apps/admin-portal/src/components/api-keys/CreateKeyDialog.tsx",
        "apps/admin-portal/src/components/api-keys/RotateKeyDialog.tsx",
        "apps/admin-portal/src/components/api-keys/DeleteKeyDialog.tsx",
        "apps/admin-portal/src/components/shared/CopyButton.tsx"
      ],
      "files_to_modify": [],
      "docker_requirements": {
        "services": [],
        "environment_variables": [],
        "volumes": [],
        "networks": []
      },
      "api_endpoints": [],
      "database_changes": {
        "collections": [],
        "indexes": [],
        "migrations": []
      },
      "status": "not_started",
      "estimated_hours": 8,
      "tags": [
        "portal",
        "api-keys",
        "crud",
        "data-table"
      ]
    },
    {
      "id": "PORTAL-203",
      "task_name": "Security Settings Page (IP/Origin Whitelists)",
      "feature_details": "Create Security page at /(dashboard)/security/page.tsx. Two tabs: IP Whitelist and Origin Whitelist. Each tab shows a table of entries with Add and Remove actions. Add dialog: input with validation (IP format for IPs, URL format for origins). Bulk add support (paste multiple, one per line). Remove with confirmation. MFA section (toggle enable/disable, QR code for TOTP setup). Session management section (table of active sessions with terminate button).",
      "feature_dependency": [
        "PORTAL-109"
      ],
      "backend_apis_used": [
        "GET /api/v1/auth/client/ip-whitelist (Auth Service — WORKING ✅)",
        "POST /api/v1/auth/client/ip-whitelist (Auth Service — WORKING ✅)",
        "DELETE /api/v1/auth/client/ip-whitelist/:ip (Auth Service — WORKING ✅)",
        "GET /api/v1/auth/client/origin-whitelist (Auth Service — WORKING ✅)",
        "POST /api/v1/auth/client/origin-whitelist (Auth Service — WORKING ✅)",
        "DELETE /api/v1/auth/client/origin-whitelist/:origin (Auth Service — WORKING ✅)",
        "GET /v1/sessions (Gateway — WORKING ✅)",
        "DELETE /api/v1/sessions/:session_id (Auth Service — WORKING ✅)"
      ],
      "backend_status": "All APIs WORKING ✅ — IP and Origin whitelists tested in E2E Phase 9",
      "testing_instructions": {
        "unit_tests": [
          "IP table renders entries",
          "IP validation rejects invalid formats",
          "Origin validation rejects invalid URLs",
          "Bulk add parses multiple entries",
          "Session table renders active sessions"
        ],
        "integration_tests": [
          "Add IP → appears in table",
          "Remove IP → disappears from table",
          "Terminate session → session removed",
          "Tab switching preserves data"
        ],
        "e2e_tests": [
          "Full security workflow: add IP → add origin → manage sessions"
        ]
      },
      "acceptance_criteria": [
        "IP and Origin whitelists fully functional",
        "Bulk add support",
        "Input validation with error messages",
        "Session management with terminate",
        "Tabbed layout with Radix Tabs",
        "Empty states when no entries"
      ],
      "files_to_create": [
        "apps/admin-portal/src/app/(dashboard)/security/page.tsx",
        "apps/admin-portal/src/components/security/WhitelistTable.tsx",
        "apps/admin-portal/src/components/security/AddWhitelistDialog.tsx",
        "apps/admin-portal/src/components/security/SessionTable.tsx",
        "apps/admin-portal/src/components/security/MfaSetup.tsx"
      ],
      "files_to_modify": [],
      "docker_requirements": {
        "services": [],
        "environment_variables": [],
        "volumes": [],
        "networks": []
      },
      "api_endpoints": [],
      "database_changes": {
        "collections": [],
        "indexes": [],
        "migrations": []
      },
      "status": "not_started",
      "estimated_hours": 6,
      "tags": [
        "portal",
        "security",
        "whitelist",
        "ip",
        "origin",
        "sessions"
      ]
    },
    {
      "id": "PORTAL-204",
      "task_name": "Audit Logs Viewer Page",
      "feature_details": "Create Audit Logs page at /(dashboard)/audit-logs/page.tsx. Full-featured log viewer with: Date range picker, action type dropdown filter, user ID search, resource type filter. DataTable with columns: Timestamp, Action, User, Resource Type, Resource ID, IP Address, Details (expandable). Pagination with configurable page size. Export to CSV button. Integrity verification button (calls /api/v1/audit/verify). Timeline view option (vertical timeline of events).",
      "feature_dependency": [
        "PORTAL-109"
      ],
      "backend_apis_used": [
        "GET /api/v1/audit/query (Compliance Service — WORKING ✅)",
        "POST /api/v1/audit/verify (Compliance Service — WORKING ✅)"
      ],
      "backend_status": "All APIs WORKING ✅",
      "testing_instructions": {
        "unit_tests": [
          "Filter controls update query params",
          "DataTable renders log entries",
          "Date range picker works",
          "CSV export generates valid file",
          "Expandable row shows full details"
        ],
        "integration_tests": [
          "Filters apply correctly to audit query",
          "Pagination works with large datasets",
          "Integrity verification returns result"
        ],
        "e2e_tests": []
      },
      "acceptance_criteria": [
        "Audit logs display in sortable data table",
        "All filters functional (date, action, user, resource)",
        "Pagination with configurable page size",
        "CSV export downloads correctly",
        "Integrity verification shows result",
        "Expandable rows for full event details"
      ],
      "files_to_create": [
        "apps/admin-portal/src/app/(dashboard)/audit-logs/page.tsx",
        "apps/admin-portal/src/components/audit/AuditTable.tsx",
        "apps/admin-portal/src/components/audit/AuditFilters.tsx",
        "apps/admin-portal/src/components/audit/AuditTimeline.tsx",
        "apps/admin-portal/src/components/shared/DateRangePicker.tsx",
        "apps/admin-portal/src/components/shared/ExportButton.tsx"
      ],
      "files_to_modify": [],
      "docker_requirements": {
        "services": [],
        "environment_variables": [],
        "volumes": [],
        "networks": []
      },
      "api_endpoints": [],
      "database_changes": {
        "collections": [],
        "indexes": [],
        "migrations": []
      },
      "status": "not_started",
      "estimated_hours": 6,
      "tags": [
        "portal",
        "audit",
        "compliance",
        "data-table",
        "export"
      ]
    },
    {
      "id": "PORTAL-205",
      "task_name": "Tenant Settings Page",
      "feature_details": "Create Settings page at /(dashboard)/settings/page.tsx. Sections: Profile (company name, timezone, locale — from GET /v1/tenant, update via PUT /v1/tenant/settings). Webhooks (from GET /v1/webhooks — list, register, test, delete). Notifications (preferences — may need backend). Data Retention (from compliance service retention policies). Encryption (from crypto service key management — view only). Each section in a Card with save buttons. Form validation with react-hook-form + zod.",
      "feature_dependency": [
        "PORTAL-109"
      ],
      "backend_apis_used": [
        "GET /v1/tenant (Gateway — WORKING ✅)",
        "PUT /v1/tenant/settings (Gateway — WORKING ✅)",
        "POST /v1/webhooks/register (Gateway — WORKING ✅)",
        "GET /v1/webhooks (Gateway — WORKING ✅)",
        "DELETE /v1/webhooks/:id (Gateway — WORKING ✅)",
        "POST /v1/webhooks/test (Gateway — WORKING ✅)"
      ],
      "backend_status": "All core APIs WORKING ✅",
      "testing_instructions": {
        "unit_tests": [
          "Profile form pre-fills with tenant data",
          "Settings save updates via PUT",
          "Webhook list renders correctly",
          "Webhook test shows success/failure"
        ],
        "integration_tests": [
          "Update settings → verify changes persist",
          "Register webhook → appears in list",
          "Test webhook → delivery result shown",
          "Delete webhook → removed from list"
        ],
        "e2e_tests": []
      },
      "acceptance_criteria": [
        "Tenant profile editable and saves",
        "Webhook CRUD fully functional",
        "Webhook test shows delivery result",
        "Form validation on all inputs",
        "Success/error toast notifications",
        "Responsive layout"
      ],
      "files_to_create": [
        "apps/admin-portal/src/app/(dashboard)/settings/page.tsx",
        "apps/admin-portal/src/components/settings/ProfileSection.tsx",
        "apps/admin-portal/src/components/settings/WebhookSection.tsx",
        "apps/admin-portal/src/components/settings/RetentionSection.tsx",
        "apps/admin-portal/src/components/settings/EncryptionSection.tsx",
        "apps/admin-portal/src/hooks/useWebhooks.ts"
      ],
      "files_to_modify": [],
      "docker_requirements": {
        "services": [],
        "environment_variables": [],
        "volumes": [],
        "networks": []
      },
      "api_endpoints": [],
      "database_changes": {
        "collections": [],
        "indexes": [],
        "migrations": []
      },
      "status": "not_started",
      "estimated_hours": 6,
      "tags": [
        "portal",
        "settings",
        "webhooks",
        "tenant",
        "configuration"
      ]
    },
    {
      "id": "PORTAL-206",
      "task_name": "Onboarding Wizard (Post-Registration Flow)",
      "feature_details": "Create post-registration onboarding wizard at /(dashboard)/onboarding/page.tsx. 6 steps: Step 1: Welcome + Company profile completion. Step 2: Application configuration (domain, IP addresses → calls IP/Origin whitelist APIs). Step 3: Feature selection (toggles for text chat, voice, video, file sharing). Step 4: API Key display (show the key generated at registration, copy button, security warnings). Step 5: SDK integration guide (tabbed: JavaScript, React, Node.js — with code snippets). Step 6: Test connection (button that creates a test SDK session and verifies it). Progress bar at top showing completion. Skip button to go to dashboard. Data persists between steps via Zustand store.",
      "feature_dependency": [
        "PORTAL-107",
        "PORTAL-109"
      ],
      "backend_apis_used": [
        "POST /api/v1/auth/client/ip-whitelist (Auth Service — WORKING ✅)",
        "POST /api/v1/auth/client/origin-whitelist (Auth Service — WORKING ✅)",
        "PUT /v1/tenant/settings (Gateway — WORKING ✅)",
        "POST /api/v1/auth/sdk/session (Auth Service — WORKING ✅)"
      ],
      "backend_status": "All APIs WORKING ✅",
      "testing_instructions": {
        "unit_tests": [
          "Step navigation works forward/backward",
          "Progress bar updates correctly",
          "IP/Origin inputs validate correctly",
          "Code snippets render with syntax highlighting",
          "Test connection shows result"
        ],
        "integration_tests": [
          "Complete wizard end-to-end",
          "Skip to dashboard works",
          "Data persists between steps"
        ],
        "e2e_tests": [
          "Register → Onboarding wizard → Dashboard"
        ]
      },
      "acceptance_criteria": [
        "6-step wizard with progress indicator",
        "All steps functional with real API calls",
        "Code snippets with copy button",
        "Test connection verifies SDK session creation",
        "Skip option available",
        "Responsive design"
      ],
      "files_to_create": [
        "apps/admin-portal/src/app/(dashboard)/onboarding/page.tsx",
        "apps/admin-portal/src/components/onboarding/WizardStep.tsx",
        "apps/admin-portal/src/components/onboarding/StepWelcome.tsx",
        "apps/admin-portal/src/components/onboarding/StepAppConfig.tsx",
        "apps/admin-portal/src/components/onboarding/StepFeatures.tsx",
        "apps/admin-portal/src/components/onboarding/StepApiKey.tsx",
        "apps/admin-portal/src/components/onboarding/StepSdkGuide.tsx",
        "apps/admin-portal/src/components/onboarding/StepTestConnection.tsx",
        "apps/admin-portal/src/components/shared/CodeBlock.tsx",
        "apps/admin-portal/src/stores/onboarding.ts"
      ],
      "files_to_modify": [],
      "docker_requirements": {
        "services": [],
        "environment_variables": [],
        "volumes": [],
        "networks": []
      },
      "api_endpoints": [],
      "database_changes": {
        "collections": [],
        "indexes": [],
        "migrations": []
      },
      "status": "not_started",
      "estimated_hours": 8,
      "tags": [
        "portal",
        "onboarding",
        "wizard",
        "multi-step"
      ]
    },
    {
      "id": "PORTAL-207",
      "task_name": "Documentation Page (Static MDX + API Reference)",
      "feature_details": "Create Documentation page at /(dashboard)/docs/page.tsx. Sidebar with nested sections: Getting Started, API Reference, SDK Guide, Webhooks, Authentication, Best Practices. Getting Started: static MDX content explaining CAAS concepts. API Reference: auto-generated from OpenAPI spec (fetch /documentation/json from gateway, render endpoints with try-it functionality). SDK Guide: code examples for JavaScript, React, React Native. Interactive API explorer with authentication (auto-fills tenant's API key). Search across documentation.",
      "feature_dependency": [
        "PORTAL-109"
      ],
      "backend_apis_used": [
        "GET /documentation/json (Gateway — WORKING ✅ — OpenAPI spec)"
      ],
      "backend_status": "OpenAPI spec endpoint WORKING ✅",
      "testing_instructions": {
        "unit_tests": [
          "Documentation sidebar renders all sections",
          "MDX content renders correctly",
          "API reference parses OpenAPI spec",
          "Search filters documentation"
        ],
        "integration_tests": [
          "API explorer makes real requests",
          "Code examples have copy buttons",
          "Navigation within docs works smoothly"
        ],
        "e2e_tests": []
      },
      "acceptance_criteria": [
        "Documentation pages render static content",
        "API reference auto-generated from OpenAPI",
        "Code examples with syntax highlighting",
        "Search functionality",
        "Responsive layout",
        "API explorer with tenant auth"
      ],
      "files_to_create": [
        "apps/admin-portal/src/app/(dashboard)/docs/page.tsx",
        "apps/admin-portal/src/app/(dashboard)/docs/layout.tsx",
        "apps/admin-portal/src/components/docs/DocsSidebar.tsx",
        "apps/admin-portal/src/components/docs/ApiReference.tsx",
        "apps/admin-portal/src/components/docs/ApiExplorer.tsx",
        "apps/admin-portal/src/components/docs/SdkGuide.tsx",
        "apps/admin-portal/src/content/getting-started.mdx",
        "apps/admin-portal/src/content/authentication.mdx",
        "apps/admin-portal/src/content/webhooks.mdx"
      ],
      "files_to_modify": [],
      "docker_requirements": {
        "services": [],
        "environment_variables": [],
        "volumes": [],
        "networks": []
      },
      "api_endpoints": [],
      "database_changes": {
        "collections": [],
        "indexes": [],
        "migrations": []
      },
      "status": "not_started",
      "estimated_hours": 6,
      "tags": [
        "portal",
        "documentation",
        "mdx",
        "api-reference",
        "openapi"
      ]
    }
  ]
}