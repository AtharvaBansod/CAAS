{
  "task_group": "portal-setup",
  "description": "Admin portal project scaffolding, design system, core layout, and API client setup",
  "priority": "critical",
  "estimated_hours": 24,
  "phase": "6.1",
  "feature_area": "admin-portal",
  "tasks": [
    {
      "id": "PORTAL-101",
      "task_name": "Next.js 14 Project Scaffolding + Docker",
      "feature_details": "Initialize a Next.js 14 (App Router) project at apps/admin-portal. Configure TypeScript strict mode, ESLint, Prettier. Create a Dockerfile for production builds (Node 20 Alpine, multi-stage). Add the admin-portal service to docker-compose.yml with dependency on gateway health. Port: 3100.",
      "feature_dependency": [],
      "backend_apis_used": [],
      "backend_status": "N/A — frontend only",
      "testing_instructions": {
        "unit_tests": [],
        "integration_tests": [
          "npm run dev starts on port 3100",
          "npm run build succeeds",
          "Docker build succeeds: docker compose build admin-portal",
          "Container starts healthy within caas-network"
        ],
        "e2e_tests": []
      },
      "acceptance_criteria": [
        "Next.js 14 App Router project compiles with zero errors",
        "TypeScript strict mode enabled",
        "Docker multi-stage build produces < 200MB image",
        "Container starts and /api/health returns 200",
        "Accessible at http://localhost:3100 within Docker stack"
      ],
      "files_to_create": [
        "apps/admin-portal/package.json",
        "apps/admin-portal/next.config.js",
        "apps/admin-portal/tsconfig.json",
        "apps/admin-portal/Dockerfile",
        "apps/admin-portal/src/app/layout.tsx",
        "apps/admin-portal/src/app/page.tsx",
        "apps/admin-portal/src/app/api/health/route.ts"
      ],
      "files_to_modify": [
        "docker-compose.yml"
      ],
      "docker_requirements": {
        "services": [
          "admin-portal"
        ],
        "environment_variables": [
          "NEXT_PUBLIC_API_URL",
          "NEXT_PUBLIC_SOCKET_URL",
          "AUTH_SERVICE_URL"
        ],
        "volumes": [],
        "networks": [
          "caas-network"
        ]
      },
      "api_endpoints": [],
      "database_changes": {
        "collections": [],
        "indexes": [],
        "migrations": []
      },
      "status": "not_started",
      "estimated_hours": 6,
      "tags": [
        "portal",
        "nextjs",
        "setup",
        "docker"
      ]
    },
    {
      "id": "PORTAL-102",
      "task_name": "Design System (Tailwind Tokens, Radix Primitives, Dark Mode)",
      "feature_details": "Create the design system foundation. Define Tailwind design tokens (colors, typography, spacing, shadows, border-radius) using CSS variables for dark/light mode. Install Radix UI primitives (Dialog, DropdownMenu, Toast, Tooltip, Tabs). Create base components: Button (variants: default, secondary, outline, ghost, destructive; sizes: sm, md, lg, icon), Input (with label and error), Card (with CardHeader, CardTitle, CardContent), Badge, Spinner, EmptyState. Use class-variance-authority for variant management.",
      "feature_dependency": [
        "PORTAL-101"
      ],
      "backend_apis_used": [],
      "backend_status": "N/A — frontend only",
      "testing_instructions": {
        "unit_tests": [
          "Button renders all variant/size combinations",
          "Input shows error state",
          "Card composes correctly",
          "Dark mode toggle switches CSS variables"
        ],
        "integration_tests": [
          "All components render in Storybook or test page",
          "Dark mode persists across page navigation"
        ],
        "e2e_tests": []
      },
      "acceptance_criteria": [
        "Design tokens defined as CSS variables",
        "Button, Input, Card, Badge, Spinner components work",
        "Dark mode toggle functional",
        "Radix Dialog, Toast, DropdownMenu integrated",
        "cn() utility function works (clsx + tailwind-merge)"
      ],
      "files_to_create": [
        "apps/admin-portal/tailwind.config.js",
        "apps/admin-portal/src/styles/globals.css",
        "apps/admin-portal/src/lib/utils.ts",
        "apps/admin-portal/src/components/ui/Button.tsx",
        "apps/admin-portal/src/components/ui/Input.tsx",
        "apps/admin-portal/src/components/ui/Card.tsx",
        "apps/admin-portal/src/components/ui/Badge.tsx",
        "apps/admin-portal/src/components/ui/Spinner.tsx",
        "apps/admin-portal/src/components/ui/EmptyState.tsx",
        "apps/admin-portal/src/components/ui/index.ts"
      ],
      "files_to_modify": [],
      "docker_requirements": {
        "services": [],
        "environment_variables": [],
        "volumes": [],
        "networks": []
      },
      "api_endpoints": [],
      "database_changes": {
        "collections": [],
        "indexes": [],
        "migrations": []
      },
      "status": "not_started",
      "estimated_hours": 6,
      "tags": [
        "portal",
        "design-system",
        "tailwind",
        "radix",
        "components"
      ]
    },
    {
      "id": "PORTAL-103",
      "task_name": "Dashboard Layout (Sidebar, Header, Breadcrumbs)",
      "feature_details": "Create the authenticated dashboard shell layout. Collapsible sidebar with navigation: Dashboard, API Keys, Security, Analytics, Audit Logs, Settings, Documentation, Team (future), Billing (future). Top header with global search, notification bell, user avatar dropdown (Profile, Settings, Logout). Breadcrumb component that auto-generates from route segments. Mobile-responsive: sidebar collapses to hamburger menu below 1024px. Persistent layout using Next.js nested layouts.",
      "feature_dependency": [
        "PORTAL-102"
      ],
      "backend_apis_used": [],
      "backend_status": "N/A — frontend only",
      "testing_instructions": {
        "unit_tests": [
          "Sidebar renders all navigation items",
          "Active state highlights current route",
          "Sidebar collapse/expand works",
          "Breadcrumbs generate from pathname"
        ],
        "integration_tests": [
          "Navigation between pages updates sidebar active state",
          "Mobile breakpoint collapses sidebar",
          "User dropdown menu opens/closes"
        ],
        "e2e_tests": []
      },
      "acceptance_criteria": [
        "Sidebar with all nav items renders",
        "Header with search, notifications, avatar",
        "Breadcrumbs auto-generate from route",
        "Mobile responsive (hamburger menu)",
        "Persistent layout (no re-render on page change)"
      ],
      "files_to_create": [
        "apps/admin-portal/src/app/(dashboard)/layout.tsx",
        "apps/admin-portal/src/components/layout/Sidebar.tsx",
        "apps/admin-portal/src/components/layout/Header.tsx",
        "apps/admin-portal/src/components/layout/Breadcrumbs.tsx",
        "apps/admin-portal/src/components/layout/MobileSidebar.tsx",
        "apps/admin-portal/src/components/layout/UserMenu.tsx"
      ],
      "files_to_modify": [],
      "docker_requirements": {
        "services": [],
        "environment_variables": [],
        "volumes": [],
        "networks": []
      },
      "api_endpoints": [],
      "database_changes": {
        "collections": [],
        "indexes": [],
        "migrations": []
      },
      "status": "not_started",
      "estimated_hours": 6,
      "tags": [
        "portal",
        "layout",
        "sidebar",
        "header",
        "responsive"
      ]
    },
    {
      "id": "PORTAL-104",
      "task_name": "API Client Layer (TanStack Query, Auth Interceptors)",
      "feature_details": "Create the API client and data-fetching infrastructure. ApiClient class with methods: get, post, put, delete. Auth interceptor that reads JWT from cookies/localStorage and attaches Authorization header. Auto-redirect to /login on 401. TanStack Query provider with defaults (staleTime: 60s, refetchOnWindowFocus: false). Create feature-specific API modules: tenantApi, apiKeysApi, securityApi, sessionsApi, auditApi, analyticsApi. Create corresponding React Query hooks for each module. Error handling with toast notifications.",
      "feature_dependency": [
        "PORTAL-101"
      ],
      "backend_apis_used": [
        "GET /v1/tenant",
        "PUT /v1/tenant/settings",
        "GET /v1/tenant/usage",
        "GET /v1/auth/api-keys",
        "POST /v1/auth/api-keys",
        "DELETE /v1/auth/api-keys/:id",
        "GET /v1/sessions",
        "GET /api/v1/audit/query"
      ],
      "backend_status": "All listed endpoints are WORKING and E2E tested",
      "testing_instructions": {
        "unit_tests": [
          "ApiClient attaches auth header",
          "ApiClient redirects on 401",
          "API modules call correct endpoints",
          "Error handler formats messages correctly"
        ],
        "integration_tests": [
          "API client connects to gateway within Docker",
          "TanStack Query caches and invalidates correctly"
        ],
        "e2e_tests": []
      },
      "acceptance_criteria": [
        "ApiClient class handles GET/POST/PUT/DELETE",
        "Auth header automatically attached",
        "401 triggers redirect to /login",
        "TanStack Query hooks work with DevTools",
        "Toast notifications on API errors",
        "Feature API modules cover all existing endpoints"
      ],
      "files_to_create": [
        "apps/admin-portal/src/lib/api-client.ts",
        "apps/admin-portal/src/lib/api/tenant.ts",
        "apps/admin-portal/src/lib/api/api-keys.ts",
        "apps/admin-portal/src/lib/api/security.ts",
        "apps/admin-portal/src/lib/api/sessions.ts",
        "apps/admin-portal/src/lib/api/audit.ts",
        "apps/admin-portal/src/lib/api/analytics.ts",
        "apps/admin-portal/src/hooks/useTenant.ts",
        "apps/admin-portal/src/hooks/useApiKeys.ts",
        "apps/admin-portal/src/hooks/useSecurity.ts",
        "apps/admin-portal/src/hooks/useSessions.ts",
        "apps/admin-portal/src/hooks/useAudit.ts",
        "apps/admin-portal/src/components/providers/QueryProvider.tsx",
        "apps/admin-portal/src/components/providers/ToastProvider.tsx"
      ],
      "files_to_modify": [],
      "docker_requirements": {
        "services": [],
        "environment_variables": [
          "NEXT_PUBLIC_API_URL"
        ],
        "volumes": [],
        "networks": []
      },
      "api_endpoints": [],
      "database_changes": {
        "collections": [],
        "indexes": [],
        "migrations": []
      },
      "status": "not_started",
      "estimated_hours": 6,
      "tags": [
        "portal",
        "api",
        "tanstack-query",
        "hooks",
        "data-fetching"
      ]
    }
  ]
}