{
  "feature_group": "core-components",
  "description": "Core chat UI components",
  "tasks": [
    {
      "task-name": "Message Component",
      "feature-details": "Create the Message component for displaying individual chat messages. Support text, media, system messages, and rich content. Include sender info, timestamp, read receipts, reactions, and message actions menu.",
      "feature-dependency": ["UI-003"],
      "ai-prompt": "Create Message component in packages/ui/src/components/Message/:\n\n1. Message.tsx - Main component:\n   Props:\n   - message: Message (from SDK types)\n   - variant: 'incoming' | 'outgoing' | 'system'\n   - showAvatar: boolean (default true)\n   - showTimestamp: boolean (default true)\n   - showSender: boolean (for groups)\n   - isGrouped: boolean (consecutive messages from same user)\n   - onReactionClick: (reaction: string) => void\n   - onReactionAdd: (emoji: string) => void\n   - onActionClick: (action: MessageAction) => void\n   - onReplyClick: () => void\n   - isHighlighted: boolean (for search results)\n   - isPending: boolean (optimistic update)\n   - renderContent?: (message: Message) => ReactNode\n\n2. Layout:\n   - Incoming: avatar on left, bubble on right side of avatar\n   - Outgoing: bubble on right, no avatar (or optional)\n   - System: centered, no bubble, muted text\n   - Avatar with presence indicator\n   - Sender name above bubble (groups only)\n   - Timestamp below bubble or inline\n\n3. MessageBubble.tsx:\n   - Background color based on variant\n   - Rounded corners (different for grouped messages)\n   - Max-width: 70% of container\n   - Text content with link detection\n   - Attachments display\n\n4. MessageContent.tsx:\n   - Render based on message type\n   - Text: preserve whitespace, linkify URLs\n   - Media: thumbnail with lightbox on click\n   - Card: rich card layout\n   - Deleted: 'This message was deleted' placeholder\n\n5. MessageStatus.tsx:\n   - Pending: clock icon\n   - Sent: single check\n   - Delivered: double check\n   - Read: double check (colored)\n   - Failed: error icon with retry button\n\n6. MessageActions.tsx:\n   - Actions menu (... button on hover)\n   - Reply, Edit (own messages), Delete, React, Copy, Forward\n   - Dropdown using Dropdown primitive\n\n7. Create comprehensive Storybook stories",
      "testing-instructions": "1. Test incoming message renders with avatar on left\n2. Test outgoing message renders without avatar on right\n3. Test system message is centered\n4. Test grouped messages have connected bubble corners\n5. Test reactions are displayed below message\n6. Test reaction click fires callback\n7. Test actions menu appears on hover\n8. Test pending state shows clock icon\n9. Test failed state shows retry button\n10. Test deleted message shows placeholder",
      "acceptance_criteria": [
        "All message variants render correctly",
        "Incoming/outgoing have correct alignment",
        "Grouped messages have visual continuity",
        "Status indicators show correct state",
        "Reactions are interactive",
        "Actions menu works on hover/tap",
        "Links are properly detected and clickable",
        "Pending/failed states are visible",
        "Accessibility: proper roles and labels"
      ],
      "files_to_create": [
        "packages/ui/src/components/Message/Message.tsx",
        "packages/ui/src/components/Message/MessageBubble.tsx",
        "packages/ui/src/components/Message/MessageContent.tsx",
        "packages/ui/src/components/Message/MessageStatus.tsx",
        "packages/ui/src/components/Message/MessageActions.tsx",
        "packages/ui/src/components/Message/MessageReactions.tsx",
        "packages/ui/src/components/Message/Message.stories.tsx",
        "packages/ui/src/components/Message/index.ts",
        "packages/ui/src/components/Message/types.ts"
      ],
      "docker_requirements": null,
      "task_id": "UI-004"
    },
    {
      "task-name": "MessageList Component",
      "feature-details": "Create the MessageList component for displaying scrollable list of messages. Support infinite scroll for loading history, auto-scroll on new messages, scroll position preservation, date separators, and unread marker.",
      "feature-dependency": ["UI-004"],
      "ai-prompt": "Create MessageList component in packages/ui/src/components/MessageList/:\n\n1. MessageList.tsx - Main component:\n   Props:\n   - messages: Message[]\n   - isLoading: boolean\n   - hasMore: boolean\n   - onLoadMore: () => void\n   - onMessageClick?: (message: Message) => void\n   - onMessageAction?: (message: Message, action: string) => void\n   - onReactionAdd?: (messageId: string, emoji: string) => void\n   - currentUserId: string\n   - highlightedMessageId?: string\n   - scrollToMessageId?: string\n   - showDateSeparators: boolean (default true)\n   - unreadCount?: number\n   - unreadSeparatorMessageId?: string\n   - renderMessage?: (message: Message, props: MessageProps) => ReactNode\n   - emptyState?: ReactNode\n\n2. Scrolling Behavior:\n   - Use ScrollArea primitive\n   - Infinite scroll: load more when scrolling up (history)\n   - Auto-scroll to bottom on new message if already at bottom\n   - Preserve scroll position when loading history\n   - Smooth scroll to highlighted message\n   - 'New messages' button when scrolled up\n\n3. DateSeparator.tsx:\n   - Display date between messages from different days\n   - Format: 'Today', 'Yesterday', 'Monday, Jan 15'\n   - Sticky positioning while scrolling\n\n4. UnreadSeparator.tsx:\n   - 'X new messages' banner\n   - Positioned at first unread message\n   - Click to dismiss\n\n5. Message Grouping:\n   - Group consecutive messages from same sender\n   - Within time threshold (e.g., 5 minutes)\n   - Pass isGrouped prop to Message component\n\n6. useMessageList.ts hook:\n   - Manage scroll position\n   - Calculate message grouping\n   - Handle infinite scroll callbacks\n   - Track if user is at bottom\n\n7. Loading States:\n   - Skeleton loader at top when loading history\n   - Empty state with custom content\n\n8. Create Storybook stories with mock messages",
      "testing-instructions": "1. Test messages render in correct order (oldest first)\n2. Test infinite scroll fires onLoadMore when at top\n3. Test auto-scroll works when at bottom and new message added\n4. Test scroll position preserved when loading history\n5. Test date separators appear between different days\n6. Test unread separator appears at correct position\n7. Test 'New messages' button appears when scrolled up\n8. Test message grouping works correctly\n9. Test scrollToMessageId scrolls to message\n10. Test empty state renders when no messages",
      "acceptance_criteria": [
        "Messages are displayed in correct order",
        "Infinite scroll loads history",
        "Auto-scroll works for new messages",
        "Scroll position is preserved",
        "Date separators are correct",
        "Message grouping reduces visual clutter",
        "Unread marker is visible",
        "Loading states are smooth",
        "Performance is good with 1000+ messages"
      ],
      "files_to_create": [
        "packages/ui/src/components/MessageList/MessageList.tsx",
        "packages/ui/src/components/MessageList/DateSeparator.tsx",
        "packages/ui/src/components/MessageList/UnreadSeparator.tsx",
        "packages/ui/src/components/MessageList/useMessageList.ts",
        "packages/ui/src/components/MessageList/MessageList.stories.tsx",
        "packages/ui/src/components/MessageList/index.ts",
        "packages/ui/src/components/MessageList/types.ts"
      ],
      "docker_requirements": null,
      "task_id": "UI-005"
    },
    {
      "task-name": "MessageInput Component",
      "feature-details": "Create a rich MessageInput component with text input, emoji picker, file attachments, mentions, and typing indicator emission. Support mobile-friendly design with expandable input area.",
      "feature-dependency": ["UI-003"],
      "ai-prompt": "Create MessageInput component in packages/ui/src/components/MessageInput/:\n\n1. MessageInput.tsx - Main component:\n   Props:\n   - value: string\n   - onChange: (value: string) => void\n   - onSend: (message: { content: string, attachments?: File[] }) => void\n   - onTypingStart?: () => void\n   - onTypingStop?: () => void\n   - onAttach?: (files: File[]) => void\n   - placeholder?: string\n   - maxLength?: number\n   - disabled?: boolean\n   - attachmentTypes?: string[] (MIME types)\n   - maxAttachments?: number\n   - maxAttachmentSize?: number (bytes)\n   - mentionableUsers?: User[]\n   - onMentionSearch?: (query: string) => User[]\n   - replyingTo?: Message | null\n   - onCancelReply?: () => void\n\n2. Layout:\n   - Reply preview bar at top (when replying)\n   - Text input in center\n   - Attachment preview below text\n   - Action buttons: attach, emoji, send\n   - Send button disabled when empty\n\n3. TextArea:\n   - Auto-resize based on content\n   - Max height with scroll\n   - Shift+Enter for new line\n   - Enter to send\n   - Character counter when near max\n\n4. EmojiPicker/EmojiPicker.tsx:\n   - Emoji mart or similar\n   - Category tabs\n   - Search\n   - Recent emojis\n   - Skin tone selector\n\n5. AttachmentPreview.tsx:\n   - Show thumbnails for images\n   - File icon for documents\n   - Remove button on each\n   - Progress bar during upload\n\n6. MentionDropdown.tsx:\n   - @ trigger for mentions\n   - Search users as typing\n   - Keyboard navigation\n   - Insert mention token\n\n7. ReplyPreview.tsx:\n   - Show message being replied to\n   - Truncated content\n   - Close button to cancel\n\n8. Typing Indicator Logic:\n   - Fire onTypingStart when user starts typing\n   - Fire onTypingStop after 2 seconds of no input\n   - Debounce to prevent spam\n\n9. Create Storybook stories",
      "testing-instructions": "1. Test text input works and onChange fires\n2. Test Enter sends message, Shift+Enter adds newline\n3. Test send button disabled when empty\n4. Test emoji picker opens and inserts emoji\n5. Test file attachment adds preview\n6. Test attachment can be removed\n7. Test mention dropdown appears on @\n8. Test mention is inserted correctly\n9. Test reply preview shows when replying\n10. Test typing indicator callbacks fire correctly\n11. Test maxLength prevents exceeding limit",
      "acceptance_criteria": [
        "Text input works correctly",
        "Enter sends, Shift+Enter newlines",
        "Emoji picker inserts emojis",
        "File attachments show previews",
        "Mentions work with @ trigger",
        "Reply preview is displayed",
        "Typing indicators fire correctly",
        "Input auto-resizes",
        "Mobile touch interactions work",
        "Accessibility: proper labels and roles"
      ],
      "files_to_create": [
        "packages/ui/src/components/MessageInput/MessageInput.tsx",
        "packages/ui/src/components/MessageInput/EmojiPicker.tsx",
        "packages/ui/src/components/MessageInput/AttachmentPreview.tsx",
        "packages/ui/src/components/MessageInput/MentionDropdown.tsx",
        "packages/ui/src/components/MessageInput/ReplyPreview.tsx",
        "packages/ui/src/components/MessageInput/useTypingIndicator.ts",
        "packages/ui/src/components/MessageInput/MessageInput.stories.tsx",
        "packages/ui/src/components/MessageInput/index.ts",
        "packages/ui/src/components/MessageInput/types.ts"
      ],
      "docker_requirements": null,
      "task_id": "UI-006"
    },
    {
      "task-name": "ConversationList Component",
      "feature-details": "Create the ConversationList component for displaying a scrollable list of conversations. Show last message preview, unread count, timestamp, and online status. Support filtering and search.",
      "feature-dependency": ["UI-003"],
      "ai-prompt": "Create ConversationList component in packages/ui/src/components/ConversationList/:\n\n1. ConversationList.tsx - Main component:\n   Props:\n   - conversations: Conversation[]\n   - selectedId?: string\n   - onSelect: (conversation: Conversation) => void\n   - onLoadMore?: () => void\n   - hasMore?: boolean\n   - isLoading?: boolean\n   - searchQuery?: string\n   - onSearch?: (query: string) => void\n   - showSearch?: boolean\n   - filterType?: 'all' | 'unread' | 'direct' | 'group'\n   - onFilterChange?: (filter: string) => void\n   - emptyState?: ReactNode\n   - renderItem?: (conversation: Conversation, isSelected: boolean) => ReactNode\n\n2. ConversationItem.tsx:\n   Props:\n   - conversation: Conversation\n   - isSelected: boolean\n   - onClick: () => void\n   Layout:\n   - Avatar (with presence for direct, group icon for group)\n   - Title (name or participant names)\n   - Last message preview (truncated)\n   - Timestamp (relative: 'Just now', '5m', '2h', 'Yesterday')\n   - Unread badge\n   - Muted indicator\n   - Pinned indicator\n\n3. ConversationSearch.tsx:\n   - Search input with icon\n   - Clear button\n   - Debounced search\n\n4. ConversationFilters.tsx:\n   - Tab bar or dropdown\n   - All, Unread, Direct, Groups\n   - Badge counts per filter\n\n5. Features:\n   - Keyboard navigation (up/down arrows)\n   - Right-click context menu (pin, mute, archive, delete)\n   - Swipe actions on mobile (mute, delete)\n   - Skeleton loading state\n   - Virtual scrolling for large lists\n\n6. Styling:\n   - Selected state highlight\n   - Hover state\n   - Unread bold styling\n   - Muted opacity reduction\n\n7. Create Storybook stories with mock data",
      "testing-instructions": "1. Test conversations render in correct order\n2. Test clicking conversation fires onSelect\n3. Test selected conversation is highlighted\n4. Test unread badge shows correct count\n5. Test search filters conversations\n6. Test filter tabs work correctly\n7. Test infinite scroll loads more\n8. Test keyboard navigation works\n9. Test right-click shows context menu\n10. Test empty state renders when no conversations",
      "acceptance_criteria": [
        "Conversations display correctly",
        "Selection state is visible",
        "Unread count is displayed",
        "Last message is truncated",
        "Timestamps are relative",
        "Search filters conversations",
        "Filter tabs work",
        "Keyboard navigation works",
        "Context menu provides actions",
        "Performance good with 100+ conversations"
      ],
      "files_to_create": [
        "packages/ui/src/components/ConversationList/ConversationList.tsx",
        "packages/ui/src/components/ConversationList/ConversationItem.tsx",
        "packages/ui/src/components/ConversationList/ConversationSearch.tsx",
        "packages/ui/src/components/ConversationList/ConversationFilters.tsx",
        "packages/ui/src/components/ConversationList/useConversationList.ts",
        "packages/ui/src/components/ConversationList/ConversationList.stories.tsx",
        "packages/ui/src/components/ConversationList/index.ts",
        "packages/ui/src/components/ConversationList/types.ts"
      ],
      "docker_requirements": null,
      "task_id": "UI-007"
    },
    {
      "task-name": "ChatContainer Component",
      "feature-details": "Create the main ChatContainer component that composes ConversationList, MessageList, and MessageInput into a complete chat interface. Support responsive layout for desktop and mobile.",
      "feature-dependency": ["UI-005", "UI-006", "UI-007"],
      "ai-prompt": "Create ChatContainer component in packages/ui/src/components/ChatContainer/:\n\n1. ChatContainer.tsx - Main component:\n   Props:\n   - client: CAASClient (SDK client)\n   - userId: string (current user)\n   - initialConversationId?: string\n   - onConversationChange?: (conversation: Conversation | null) => void\n   - layout?: 'full' | 'embedded' | 'popup'\n   - showConversationList?: boolean (default true)\n   - showHeader?: boolean (default true)\n   - height?: string | number\n   - width?: string | number\n   - className?: string\n   - renderHeader?: (conversation: Conversation | null) => ReactNode\n   - renderEmpty?: () => ReactNode\n\n2. Layout:\n   - Full layout: sidebar + main area\n   - Embedded: fits in container\n   - Popup: fixed position, draggable\n   - Responsive: stack on mobile (<768px)\n\n3. ChatHeader.tsx:\n   - Conversation name/title\n   - Avatar(s)\n   - Presence status\n   - Actions: search, info, call buttons\n   - Back button on mobile\n\n4. ChatSidebar.tsx:\n   - ConversationList\n   - New conversation button\n   - User profile/settings\n\n5. ChatMain.tsx:\n   - MessageList\n   - MessageInput\n   - No conversation selected state\n\n6. Responsive Behavior:\n   - Mobile: full screen, slide between list and chat\n   - Desktop: side-by-side\n   - Breakpoint customizable\n\n7. State Management:\n   - Use SDK React hooks (useConversations, useMessages, etc.)\n   - Handle connection status\n   - Show offline indicator\n\n8. useChatContainer.ts hook:\n   - Selected conversation state\n   - Send message handler\n   - Load more handlers\n   - Typing indicator\n\n9. Create Storybook stories with mock SDK client",
      "testing-instructions": "1. Test container renders with SDK client\n2. Test conversation list shows conversations\n3. Test selecting conversation shows messages\n4. Test sending message appears in list\n5. Test responsive layout switches on resize\n6. Test mobile back button returns to list\n7. Test header shows correct conversation info\n8. Test offline indicator appears when disconnected\n9. Test typing indicator shows when others type\n10. Test all SDK hooks integrate correctly",
      "acceptance_criteria": [
        "Complete chat UI is rendered",
        "SDK integration works correctly",
        "Conversations can be selected",
        "Messages are displayed",
        "Messages can be sent",
        "Responsive layout works",
        "Mobile navigation works",
        "Connection status is shown",
        "Typing indicators work",
        "All components integrate smoothly"
      ],
      "files_to_create": [
        "packages/ui/src/components/ChatContainer/ChatContainer.tsx",
        "packages/ui/src/components/ChatContainer/ChatHeader.tsx",
        "packages/ui/src/components/ChatContainer/ChatSidebar.tsx",
        "packages/ui/src/components/ChatContainer/ChatMain.tsx",
        "packages/ui/src/components/ChatContainer/useChatContainer.ts",
        "packages/ui/src/components/ChatContainer/ChatContainer.stories.tsx",
        "packages/ui/src/components/ChatContainer/index.ts",
        "packages/ui/src/components/ChatContainer/types.ts"
      ],
      "docker_requirements": null,
      "task_id": "UI-008"
    }
  ]
}
