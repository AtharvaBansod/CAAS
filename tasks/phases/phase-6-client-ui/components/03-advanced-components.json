{
  "feature_group": "advanced-components",
  "description": "Advanced chat components and features",
  "tasks": [
    {
      "task-name": "Media Gallery Components",
      "feature-details": "Create media-related components including MediaPreview (thumbnails), MediaViewer (lightbox), ImageGallery, and VideoPlayer. Support image zoom, swipe gestures, and download.",
      "feature-dependency": ["UI-003"],
      "ai-prompt": "Create media components in packages/ui/src/components/Media/:\n\n1. MediaPreview.tsx:\n   Props:\n   - media: Media (from SDK types)\n   - size: 'small' | 'medium' | 'large'\n   - onClick?: () => void\n   - showDownload?: boolean\n   - showDuration?: boolean (for video)\n   Features:\n   - Image thumbnail with lazy loading\n   - Video thumbnail with play icon overlay\n   - Document icon for non-visual files\n   - Loading skeleton\n   - Error state with retry\n\n2. MediaViewer.tsx (Lightbox):\n   Props:\n   - media: Media[]\n   - initialIndex: number\n   - isOpen: boolean\n   - onClose: () => void\n   - onDownload?: (media: Media) => void\n   Features:\n   - Full-screen overlay\n   - Image with pinch-to-zoom (Framer Motion)\n   - Swipe to navigate between images\n   - Arrow buttons for navigation\n   - Counter (1/5)\n   - Download button\n   - Close button\n   - Keyboard navigation (arrow keys, escape)\n   - Video playback\n\n3. ImageGallery.tsx:\n   Props:\n   - images: Media[]\n   - maxVisible?: number (default 4)\n   - onImageClick?: (index: number) => void\n   Features:\n   - Grid layout for multiple images\n   - '+N more' overlay when exceeds maxVisible\n   - Different layouts: 1, 2, 3, 4+ images\n   - Opens MediaViewer on click\n\n4. VideoPlayer.tsx:\n   Props:\n   - src: string\n   - poster?: string\n   - autoPlay?: boolean\n   - muted?: boolean\n   - controls?: boolean\n   Features:\n   - Custom controls overlay\n   - Play/pause, volume, progress, fullscreen\n   - Picture-in-picture support\n   - Loading state\n\n5. AudioPlayer.tsx:\n   Props:\n   - src: string\n   - duration: number\n   Features:\n   - Waveform visualization\n   - Play/pause button\n   - Progress bar with scrubbing\n   - Duration display\n\n6. Create Storybook stories for all components",
      "testing-instructions": "1. Test MediaPreview renders image thumbnails\n2. Test MediaPreview shows video duration\n3. Test MediaViewer opens and closes\n4. Test swipe navigation in MediaViewer\n5. Test zoom functionality\n6. Test keyboard navigation\n7. Test ImageGallery shows +N overlay\n8. Test VideoPlayer plays video\n9. Test AudioPlayer shows waveform\n10. Test download button downloads file",
      "acceptance_criteria": [
        "Thumbnails load lazily",
        "Lightbox opens and closes smoothly",
        "Zoom and pan works on images",
        "Swipe navigation works",
        "Keyboard navigation works",
        "Video playback works",
        "Audio playback with visualization",
        "Download functionality works",
        "Gallery layouts are correct",
        "All components are accessible"
      ],
      "files_to_create": [
        "packages/ui/src/components/Media/MediaPreview.tsx",
        "packages/ui/src/components/Media/MediaViewer.tsx",
        "packages/ui/src/components/Media/ImageGallery.tsx",
        "packages/ui/src/components/Media/VideoPlayer.tsx",
        "packages/ui/src/components/Media/AudioPlayer.tsx",
        "packages/ui/src/components/Media/Media.stories.tsx",
        "packages/ui/src/components/Media/index.ts",
        "packages/ui/src/components/Media/types.ts"
      ],
      "docker_requirements": null,
      "task_id": "UI-009"
    },
    {
      "task-name": "Typing and Presence Indicators",
      "feature-details": "Create visual indicators for typing status and user presence. TypingIndicator shows animated dots with user names. PresenceIndicator shows online/offline status. PresenceDot is a small status indicator for avatars.",
      "feature-dependency": ["UI-003"],
      "ai-prompt": "Create presence components in packages/ui/src/components/Presence/:\n\n1. TypingIndicator.tsx:\n   Props:\n   - users: User[] (users currently typing)\n   - maxVisible?: number (default 3)\n   Features:\n   - Animated bouncing dots (3 dots)\n   - Text: 'John is typing...', 'John and Jane are typing...', '3 people are typing...'\n   - Fade in/out animation\n   - Optional avatar display\n\n2. TypingDots.tsx:\n   - Three dots with staggered bounce animation\n   - Pure CSS animation (no JS)\n   - Customizable color via theme\n\n3. PresenceIndicator.tsx:\n   Props:\n   - status: 'online' | 'away' | 'busy' | 'offline'\n   - showLabel?: boolean\n   - lastSeen?: Date\n   Features:\n   - Colored dot indicator\n   - Optional status label\n   - 'Last seen 5 minutes ago' for offline\n   - Pulse animation for online\n\n4. PresenceDot.tsx:\n   Props:\n   - status: 'online' | 'away' | 'busy' | 'offline'\n   - size: 'sm' | 'md' | 'lg'\n   - position?: 'top-right' | 'bottom-right'\n   Features:\n   - Small colored circle\n   - For overlaying on avatars\n   - Colors: online=green, away=yellow, busy=red, offline=gray\n   - Border to stand out against avatar\n\n5. OnlineUsersBar.tsx:\n   Props:\n   - users: User[]\n   - maxVisible?: number (default 5)\n   - onUserClick?: (user: User) => void\n   Features:\n   - Horizontal bar of online user avatars\n   - Stacked/overlapping style\n   - '+N online' indicator\n   - Tooltip with user name on hover\n\n6. Create Storybook stories demonstrating all states",
      "testing-instructions": "1. Test TypingIndicator shows correct text for 1, 2, 3+ users\n2. Test typing dots animate correctly\n3. Test PresenceIndicator shows correct color for each status\n4. Test 'last seen' displays relative time\n5. Test PresenceDot positions correctly on avatar\n6. Test OnlineUsersBar shows stacked avatars\n7. Test tooltip appears on hover\n8. Test animations are smooth (60fps)\n9. Test accessibility announcements",
      "acceptance_criteria": [
        "Typing indicator shows user names",
        "Dots animate smoothly",
        "Presence colors are distinct",
        "Last seen time is relative",
        "Presence dot overlays correctly",
        "Online users bar is interactive",
        "Animations are performant",
        "Accessibility is maintained"
      ],
      "files_to_create": [
        "packages/ui/src/components/Presence/TypingIndicator.tsx",
        "packages/ui/src/components/Presence/TypingDots.tsx",
        "packages/ui/src/components/Presence/PresenceIndicator.tsx",
        "packages/ui/src/components/Presence/PresenceDot.tsx",
        "packages/ui/src/components/Presence/OnlineUsersBar.tsx",
        "packages/ui/src/components/Presence/Presence.stories.tsx",
        "packages/ui/src/components/Presence/index.ts"
      ],
      "docker_requirements": null,
      "task_id": "UI-010"
    },
    {
      "task-name": "Reactions Component",
      "feature-details": "Create emoji reactions components for messages. ReactionBar displays current reactions with counts. ReactionPicker allows adding new reactions. Support for custom emoji and reaction limits.",
      "feature-dependency": ["UI-003"],
      "ai-prompt": "Create reaction components in packages/ui/src/components/Reactions/:\n\n1. ReactionBar.tsx:\n   Props:\n   - reactions: Reaction[] (emoji, count, users[])\n   - onReactionClick: (emoji: string) => void\n   - currentUserId: string\n   - maxVisible?: number (default 5)\n   - size?: 'sm' | 'md'\n   Features:\n   - Display emoji pills with count\n   - Highlight if current user reacted\n   - Tooltip showing who reacted\n   - '+N' for overflow reactions\n   - Click to toggle own reaction\n\n2. ReactionPicker.tsx:\n   Props:\n   - onSelect: (emoji: string) => void\n   - recentEmojis?: string[]\n   - customEmojis?: CustomEmoji[]\n   - position?: 'top' | 'bottom' | 'auto'\n   Features:\n   - Quick reaction bar (ðŸ‘ â¤ï¸ ðŸ˜‚ ðŸ˜® ðŸ˜¢ ðŸ™)\n   - Full emoji picker on expand\n   - Recent emojis section\n   - Custom emoji support\n   - Keyboard search\n\n3. ReactionButton.tsx:\n   Props:\n   - onClick: () => void\n   - isActive?: boolean\n   Features:\n   - Smiley face icon button\n   - Opens ReactionPicker\n   - Hover state\n   - Used in message actions\n\n4. ReactionPill.tsx:\n   Props:\n   - emoji: string\n   - count: number\n   - isActive: boolean\n   - onClick: () => void\n   - users: User[]\n   Features:\n   - Rounded pill shape\n   - Emoji + count\n   - Blue background if user reacted\n   - Tooltip with user names\n   - Animation on count change\n\n5. ReactionTooltip.tsx:\n   - List of users who reacted\n   - Truncate if many users\n   - Avatar + name\n\n6. Create Storybook stories",
      "testing-instructions": "1. Test ReactionBar displays reactions\n2. Test reaction counts are correct\n3. Test current user's reactions are highlighted\n4. Test clicking reaction toggles it\n5. Test ReactionPicker opens and closes\n6. Test selecting emoji calls onSelect\n7. Test quick reactions are clickable\n8. Test tooltip shows user names\n9. Test overflow indicator works\n10. Test animations on count change",
      "acceptance_criteria": [
        "Reactions display with counts",
        "User's own reactions are highlighted",
        "Clicking toggles reaction",
        "Picker shows quick and full options",
        "Tooltip shows who reacted",
        "Overflow handled correctly",
        "Animations are smooth",
        "Accessibility: screen reader support"
      ],
      "files_to_create": [
        "packages/ui/src/components/Reactions/ReactionBar.tsx",
        "packages/ui/src/components/Reactions/ReactionPicker.tsx",
        "packages/ui/src/components/Reactions/ReactionButton.tsx",
        "packages/ui/src/components/Reactions/ReactionPill.tsx",
        "packages/ui/src/components/Reactions/ReactionTooltip.tsx",
        "packages/ui/src/components/Reactions/Reactions.stories.tsx",
        "packages/ui/src/components/Reactions/index.ts",
        "packages/ui/src/components/Reactions/types.ts"
      ],
      "docker_requirements": null,
      "task_id": "UI-011"
    },
    {
      "task-name": "Thread View Component",
      "feature-details": "Create a thread/reply view component for displaying message threads. Shows parent message with replies below. Support for opening thread in side panel or modal.",
      "feature-dependency": ["UI-004", "UI-005", "UI-006"],
      "ai-prompt": "Create thread components in packages/ui/src/components/Thread/:\n\n1. ThreadView.tsx:\n   Props:\n   - parentMessage: Message\n   - replies: Message[]\n   - onSendReply: (content: string, attachments?: File[]) => void\n   - onClose?: () => void\n   - isLoading?: boolean\n   - hasMore?: boolean\n   - onLoadMore?: () => void\n   - currentUserId: string\n   - onMessageAction?: (message: Message, action: string) => void\n   Features:\n   - Parent message at top (larger, highlighted)\n   - Divider\n   - Replies list (MessageList)\n   - Reply count\n   - Reply input at bottom\n   - Scroll to bottom on new reply\n\n2. ThreadHeader.tsx:\n   - 'Thread' title\n   - Reply count\n   - Close button\n   - Parent message sender info\n\n3. ParentMessage.tsx:\n   - Extended Message component\n   - Slightly different styling\n   - 'X replies' indicator\n   - Jump to original context\n\n4. ThreadReplyInput.tsx:\n   - Simplified MessageInput\n   - Mentions participants\n   - Placeholder: 'Reply to thread...'\n\n5. ThreadPreview.tsx:\n   - Collapsed thread indicator\n   - Shows on parent message\n   - 'X replies, last by [User]'\n   - Click to expand thread\n\n6. ThreadPanel.tsx:\n   - Side panel container for thread\n   - Slides in from right\n   - Can be resized\n   - Responsive: full screen on mobile\n\n7. useThread.ts hook:\n   - Manage reply state\n   - Handle send reply\n   - Track read state\n\n8. Create Storybook stories",
      "testing-instructions": "1. Test parent message displays at top\n2. Test replies display below parent\n3. Test sending reply adds to list\n4. Test load more loads older replies\n5. Test close button closes thread\n6. Test ThreadPreview shows reply count\n7. Test clicking preview opens thread\n8. Test ThreadPanel slides in\n9. Test mobile layout is full screen\n10. Test scroll to bottom on new reply",
      "acceptance_criteria": [
        "Parent message is highlighted",
        "Replies display chronologically",
        "Reply input works correctly",
        "Load more loads history",
        "Thread can be closed",
        "Preview shows on parent messages",
        "Panel slides smoothly",
        "Mobile layout works",
        "Keyboard accessible"
      ],
      "files_to_create": [
        "packages/ui/src/components/Thread/ThreadView.tsx",
        "packages/ui/src/components/Thread/ThreadHeader.tsx",
        "packages/ui/src/components/Thread/ParentMessage.tsx",
        "packages/ui/src/components/Thread/ThreadReplyInput.tsx",
        "packages/ui/src/components/Thread/ThreadPreview.tsx",
        "packages/ui/src/components/Thread/ThreadPanel.tsx",
        "packages/ui/src/components/Thread/useThread.ts",
        "packages/ui/src/components/Thread/Thread.stories.tsx",
        "packages/ui/src/components/Thread/index.ts",
        "packages/ui/src/components/Thread/types.ts"
      ],
      "docker_requirements": null,
      "task_id": "UI-012"
    }
  ]
}
